# v1.2 FIXES - LABELING, PRECISION, AND GROUPING

**Date:** 2025-12-19
**Status:** ✅ Complete
**URL:** http://localhost:3000

---

## Summary

Fixed PIW/PIL labeling, increased decimal precision to 0.001, and moved friction_coeff and motor_rpm to the Power-User Parameters section.

---

## Changes Made

### A) PIW/PIL Meaning and UI Labels ✅

**Updated Labels:**
- **PIW** = Pounds per Inch of Width (lb/in)
- **PIL** = Pounds per Inch of Length (lb/in)

**Form Labels (CalculatorForm.tsx):**
```tsx
// Before:
"Belt Coefficient PIW"
"Belt Coefficient PIL"

// After:
"PIW - Pounds per Inch of Width (lb/in, 0.05-0.30, default: auto)"
"PIL - Pounds per Inch of Length (lb/in, 0.05-0.30, default: auto)"
```

**Results Labels (CalculationResults.tsx):**
```tsx
// Before:
"Belt Coeff (piw)"
"Belt Coeff (pil)"

// After:
"PIW (lb/in width)"
"PIL (lb/in length)"
```

**Schema Documentation (schema.ts):**
```typescript
// Before:
/** Belt weight coefficient piw (default: 0.109, range: 0.05–0.30) */

// After:
/** Belt weight coefficient - Pounds per Inch of Width (lb/in, default: 0.109, range: 0.05–0.30) */
```

---

### B) Decimal Precision ✅

**Input Step Changed:**
```tsx
// Before:
step="0.01"  // Only 2 decimal places

// After:
step="0.001" // Allows 3 decimal places
```

**Validation:**
- Accepts 0.001 resolution
- Range still 0.05-0.30
- No changes to validation logic (already allowed 3 decimals)

**Display:**
- PIW/PIL already displayed with 3 decimals in results (decimals={3})
- No changes needed to display logic

---

### C) Parameters Section Reorganization ✅

**Moved to Power-User Parameters:**
1. **friction_coeff**
   - Default: 0.25
   - Range: 0.05-0.6
   - Step: 0.01
   - Added to inputs schema
   - Added to form UI
   - Added to results display

2. **motor_rpm**
   - Default: 1750
   - Range: 800-3600
   - Step: 10
   - Added to inputs schema
   - Added to form UI
   - Added to results display

**Power-User Parameters Section Now Contains (6 total):**
1. Safety Factor (1.0-5.0, default: 2.0)
2. PIW - Pounds per Inch of Width (0.05-0.30, default: auto)
3. PIL - Pounds per Inch of Length (0.05-0.30, default: auto)
4. Base Belt Pull (0-200 lb/ft, default: 75)
5. **Friction Coefficient (0.05-0.6, default: 0.25)** ← NEW
6. **Motor RPM (800-3600, default: 1750)** ← NEW

---

## Files Modified (4)

### 1. src/models/sliderbed_v1/schema.ts

**Added to SliderbedInputs:**
```typescript
/** Friction coefficient (default: 0.25, range: 0.05–0.6) */
friction_coeff?: number;

/** Motor RPM (default: 1750, range: 800–3600) */
motor_rpm?: number;
```

**Added to SliderbedOutputs:**
```typescript
/** Friction coefficient used */
friction_coeff_used: number;

/** Motor RPM used */
motor_rpm_used: number;
```

**Updated Documentation:**
- PIW/PIL comments now include full meaning

---

### 2. src/models/sliderbed_v1/formulas.ts

**Extract User Overrides:**
```typescript
const frictionCoeff = inputs.friction_coeff ?? parameters.friction_coeff;
const motorRpm = inputs.motor_rpm ?? parameters.motor_rpm;
```

**Use in Calculations:**
```typescript
// Step 8: Belt pull calculation (now uses user friction_coeff)
const beltPullCalcLbf = calculateBeltPull(
  avgLoadPerFt,
  frictionCoeff,  // ← Changed from parameters.friction_coeff
  inputs.conveyor_length_cc_in
);

// Step 13: Gear ratio (now uses user motor_rpm)
const gearRatio = calculateGearRatio(
  motorRpm,  // ← Changed from parameters.motor_rpm
  driveShaftRpm
);
```

**Add to Outputs:**
```typescript
friction_coeff_used: frictionCoeff,
motor_rpm_used: motorRpm,
```

---

### 3. src/models/sliderbed_v1/rules.ts

**Added Validation Rules:**
```typescript
// Friction coefficient validation
if (inputs.friction_coeff !== undefined && inputs.friction_coeff < 0.05) {
  errors.push({ field: 'friction_coeff', message: 'Friction coefficient must be >= 0.05' });
}
if (inputs.friction_coeff !== undefined && inputs.friction_coeff > 0.6) {
  errors.push({ field: 'friction_coeff', message: 'Friction coefficient must be <= 0.6' });
}

// Motor RPM validation
if (inputs.motor_rpm !== undefined && inputs.motor_rpm < 800) {
  errors.push({ field: 'motor_rpm', message: 'Motor RPM must be >= 800' });
}
if (inputs.motor_rpm !== undefined && inputs.motor_rpm > 3600) {
  errors.push({ field: 'motor_rpm', message: 'Motor RPM must be <= 3600' });
}
```

---

### 4. app/components/CalculatorForm.tsx

**Updated PIW/PIL Labels and Precision:**
```tsx
<label>
  PIW - Pounds per Inch of Width
  <span>(lb/in, 0.05-0.30, default: auto)</span>
</label>
<input
  step="0.001"  // ← Changed from 0.01
  // ... other props
/>
```

**Added New Inputs:**
```tsx
<div>
  <label htmlFor="friction_coeff">
    Friction Coefficient <span>(0.05-0.6, default: 0.25)</span>
  </label>
  <input
    type="number"
    id="friction_coeff"
    value={inputs.friction_coeff || ''}
    onChange={(e) => updateInput('friction_coeff', e.target.value ? parseFloat(e.target.value) : undefined)}
    min="0.05"
    max="0.6"
    step="0.01"
    placeholder="0.25"
  />
</div>

<div>
  <label htmlFor="motor_rpm">
    Motor RPM <span>(800-3600, default: 1750)</span>
  </label>
  <input
    type="number"
    id="motor_rpm"
    value={inputs.motor_rpm || ''}
    onChange={(e) => updateInput('motor_rpm', e.target.value ? parseFloat(e.target.value) : undefined)}
    min="800"
    max="3600"
    step="10"
    placeholder="1750"
  />
</div>
```

---

### 5. app/components/CalculationResults.tsx

**Updated Labels:**
```tsx
<ResultRow label="PIW (lb/in width)" value={outputs.piw_used} decimals={3} />
<ResultRow label="PIL (lb/in length)" value={outputs.pil_used} decimals={3} />
```

**Added New Outputs:**
```tsx
<ResultRow label="Friction Coefficient" value={outputs.friction_coeff_used} decimals={2} />
<ResultRow label="Motor RPM" value={outputs.motor_rpm_used} decimals={0} />
```

---

## Testing Status

✅ **All 31 tests pass** (npm test)
```
Test Suites: 1 passed, 1 total
Tests:       31 passed, 31 total
```

✅ **Dev server running** at http://localhost:3000

---

## Verification Checklist

### PIW/PIL Labels
- [x] Form labels include full meaning
- [x] Results labels clarified
- [x] Schema documentation updated
- [x] Units shown (lb/in)

### Decimal Precision
- [x] Input step changed to 0.001
- [x] Allows 3 decimal places
- [x] Validation accepts 0.001 resolution
- [x] Display shows 3 decimals

### Parameter Grouping
- [x] friction_coeff in Power-User section
- [x] motor_rpm in Power-User section
- [x] Both have proper defaults
- [x] Both have proper ranges
- [x] Both show in results
- [x] Both included in calculation payload

---

## Example Usage

### Form Input Section:
```
Power-User Parameters (Optional)

Safety Factor (1.0-5.0, default: 2.0)
  [_____]

PIW - Pounds per Inch of Width (lb/in, 0.05-0.30, default: auto)
  [_____]

PIL - Pounds per Inch of Length (lb/in, 0.05-0.30, default: auto)
  [_____]

Base Belt Pull (lb/ft, 0-200, default: 75)
  [_____]

Friction Coefficient (0.05-0.6, default: 0.25)  ← NEW
  [_____]

Motor RPM (800-3600, default: 1750)  ← NEW
  [_____]
```

### Results Display:
```
Parameters Used

Safety Factor: 2.00
PIW (lb/in width): 0.138
PIL (lb/in length): 0.138
Base Belt Pull: 75.0 lb/ft
Friction Coefficient: 0.25  ← NEW
Motor RPM: 1750  ← NEW
```

---

## Calculation Logic

**No Changes to Calculation Logic** ✓

The same values are used, just sourced from inputs instead of parameters when provided:

```typescript
// Before (v1.2 initial):
const friction = parameters.friction_coeff;  // Always from parameters
const rpm = parameters.motor_rpm;            // Always from parameters

// After (v1.2 fixes):
const friction = inputs.friction_coeff ?? parameters.friction_coeff;  // User override or default
const rpm = inputs.motor_rpm ?? parameters.motor_rpm;                  // User override or default
```

Calculations remain identical - just the source of values changed.

---

## Impact Summary

### UI Changes
- 2 labels updated (PIW/PIL)
- 2 inputs added (friction_coeff, motor_rpm)
- 2 results added (friction_coeff_used, motor_rpm_used)
- 1 precision change (0.01 → 0.001 for PIW/PIL)

### Backend Changes
- 2 new optional input fields
- 2 new output fields
- 4 new validation rules
- 2 new parameter extractions in calculate()

### User Experience
- Clearer labels (full meanings shown)
- More precision for PIW/PIL (0.001 vs 0.01)
- More control (can now adjust friction and motor RPM)
- Better organization (all power-user params in one section)

---

## Before/After Comparison

### Before (v1.2 initial)
**Power-User Parameters (4):**
- Safety Factor
- Belt Coeff PIW
- Belt Coeff PIL
- Base Belt Pull

**Results Parameters Used (4):**
- Safety Factor: 2.00
- Belt Coeff (piw): 0.138
- Belt Coeff (pil): 0.138
- Base Belt Pull: 75.0 lb/ft

### After (v1.2 fixes)
**Power-User Parameters (6):**
- Safety Factor
- **PIW - Pounds per Inch of Width** (lb/in) ← RENAMED
- **PIL - Pounds per Inch of Length** (lb/in) ← RENAMED
- Base Belt Pull
- **Friction Coefficient** ← ADDED
- **Motor RPM** ← ADDED

**Results Parameters Used (6):**
- Safety Factor: 2.00
- **PIW (lb/in width): 0.138** ← RENAMED
- **PIL (lb/in length): 0.138** ← RENAMED
- Base Belt Pull: 75.0 lb/ft
- **Friction Coefficient: 0.25** ← ADDED
- **Motor RPM: 1750** ← ADDED

---

**STATUS: ✅ ALL FIXES COMPLETE**

All requirements met:
- ✅ PIW/PIL labels updated with full meanings
- ✅ Decimal precision increased to 0.001
- ✅ friction_coeff and motor_rpm moved to Power-User section
- ✅ All tests passing
- ✅ Dev server running
- ✅ No calculation logic changes

**Ready for user testing at http://localhost:3000**

---

**END OF FIXES SUMMARY**
